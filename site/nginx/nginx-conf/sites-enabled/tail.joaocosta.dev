server {
  listen 443 ssl;
  listen [::]:443 ssl;

  server_name tail.joaocosta.dev;

  location = /auth {
    internal;

    proxy_pass http://unix:/run/tailscale.nginx-auth.sock;
    proxy_pass_request_body off;

    proxy_set_header Host $http_host;
    proxy_set_header Remote-Addr $remote_addr;
    proxy_set_header Remote-Port $remote_port;
    proxy_set_header Original-URI $request_uri;

    # throw a 403 - forbidden to those outside the net
    proxy_set_header Expected-Tailnet "joaocostaifg.github";
  }
}

server {
  # redirect all http to https
  listen 80;
  listen [::]:80;

  server_name tail.joaocosta.dev;

  return 301 https://$host$request_uri;
}
