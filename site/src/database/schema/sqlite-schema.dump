-- || USER --
DROP TABLE IF EXISTS users;
CREATE TABLE users (
  id INTEGER PRIMARY KEY ASC,
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL
);

-- || BLOG --
DROP TABLE IF EXISTS blogs;
CREATE TABLE blogs (
  id INTEGER PRIMARY KEY ASC,
  date INTEGER NOT NULL DEFAULT (strftime('%s', CURRENT_TIMESTAMP)),
  title TEXT UNIQUE NOT NULL,
  intro TEXT,
  content TEXT NOT NULL,
  visible INTEGER NOT NULL DEFAULT 0
);

DROP INDEX IF EXISTS idx_blog_date;
CREATE INDEX idx_blog_date
ON blogs(blog_date);

DROP TABLE IF EXISTS edits;
CREATE TABLE edits (
  edit_id INTEGER PRIMARY KEY ASC,
  edit_date INTEGER NOT NULL DEFAULT (strftime('%s', CURRENT_TIMESTAMP)),
  edit_content TEXT NOT NULL,
  blog_id INTEGER NOT NULL,
  FOREIGN KEY(blog_id) REFERENCES Blog
);

DROP INDEX IF EXISTS idx_edit_date;
CREATE INDEX idx_edit_date
ON edits(edit_date);

DROP TABLE IF EXISTS tags;
CREATE TABLE tags (
  tag_id INTEGER PRIMARY KEY ASC,
  tag_name TEXT UNIQUE NOT NULL
);

DROP TABLE IF EXISTS blog_tags;
CREATE TABLE blog_tags (
  blog_id INTEGER NOT NULL,
  tag_id INTEGER NOT NULL,
  FOREIGN KEY(blog_id) REFERENCES Blog,
  FOREIGN KEY(tag_id) REFERENCES Tag,
  PRIMARY KEY(blog_id, tag_id)
);

-- || PROJ --
DROP TABLE IF EXISTS projs;
CREATE TABLE projs (
  proj_id INTEGER PRIMARY KEY ASC,
  proj_title TEXT UNIQUE NOT NULL,
  proj_description TEXT,
  proj_url TEXT UNIQUE NOT NULL,
  proj_img TEXT UNIQUE NOT NULL
);
